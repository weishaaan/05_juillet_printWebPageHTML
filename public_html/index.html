<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Printer page</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https:/maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
        <link rel="shortcut icon" href="">
        <script src="//oss.maxcdn.com/bootbox/4.2.0/bootbox.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.5.3/js/bootstrapValidator.js"></script>
        
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
        
        <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    
    </head>

    <body>
        <div><div class="well">MORA - Printing Service</div></div>
        <p></p>
        <p><b>         Motus étiquettes de cartons</b></p>
        <p></p>
        <div class="container"> 
            <div class="row">
                <div class="col-xs-6 col-md-4"><div class="well">
                        <table id="eventsTable" data-height="160">
                            <thead>
                                <tr>
                                    <th data-field="state" data-radio="true"></th>
                                    <th data-field="ofNum">ofNum</th>
                                    <!--
                                    
                                    <th data-field="sreference">sreference</th>
                                    -->
                                </tr>
                            </thead>
                        </table>
                    </div></div>

                <div class="col-xs-6 col-md-4"><div class="well">
                        <label>Info détaillé:</label>
                        <p></p>
                        <label for="ofNum">ofNum:</label>
                        <label id="ofNum"></label>
                        <p></p>
                        <label for="ref">Ref: </label>
                        <label id="ref"></label>
                        <p></p>
                        <label for="ref">sReference: </label>
                        <label id="sref"></label>
                        <p></p>
                    </div></div>

                <div class="col-xs-6 col-md-4"><div class="well">
                        <p></p>
                        <table id="printerTable" data-height="160">
                            <thead>
                                <tr>
                                    <th data-field="state" data-radio="true"></th>
                                    <th data-field="NAME">Imprimantes:</th>
                                </tr>
                            </thead>
                        </table>
                    </div></div>

                <div  style="display: none;">
                    <label id="printer"></label>
                </div>

                <div class="col-xs-6 col-md-4">
                    <div class="well">
                        <p><b>Étiquettes</b></p>
                        <p></p>
                        <form role="form" id="etiquette_form">
                            <div class="form-group">
                                <label for="number">Nombre:</label>
                                <input type="text" class="form-control" id="number">
                            </div>
                            <div class="form-group">
                                <label for="type">Type:</label>
                                <input type="text" class="form-control" id="type">
                            </div>
                        </form>
                    </div>
                </div>

                <div class="col-xs-6 col-md-4">
                    <div class="well">
                        <p><b>Champs à compléter</b></p>
                        <p></p>
                        <div class="form-group">
                            <label for="datepicker">Date:</label>
                            <input type="text" id="datepicker" />
                        </div>
                        <form role="form" id="etiquette_form">
                            <div class="form-group">
                                <label for="express">numéro:Expédition:</label>
                                <input type="text" class="form-control" id="express" >
                            </div>
                            <div class="form-group">
                                <label for="bl">num BL:</label>
                                <input type="text" class="form-control" id="bl">
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-xs-6 col-md-4">
                    <div >
                        <button id="btn_print" >Imprimer</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                
                var request = new XMLHttpRequest();
                request.open("GET", "config.xml", false);
                request.send();
                var xml = request.responseXML;
                var config = xml.getElementsByTagName("configuration");
                
                for(var i = 0; i < config.length; i++) {
                    var url = config[i];
                    var names = url.getElementsByTagName("url");
                    var url1 = names[0].childNodes[0].nodeValue;
                    var url2 = names[1].childNodes[0].nodeValue;
                    //for(var j = 0; j < names.length; j++) {
                      //  alert(names[j].childNodes[0].nodeValue);
                    //}
                }
                
                $( "#datepicker" ).datepicker({
                    changeMonth: true,//this option for allowing user to select month
                    changeYear: true, //this option for allowing user to select from year range
                    monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
                    monthNamesShort: ['Janv.', 'Févr.', 'Mars', 'Avril', 'Mai', 'Juin', 'Juil.', 'Août', 'Sept.', 'Oct.', 'Nov.', 'Déc.'],
                    dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
                    dayNamesShort: ['Dim.', 'Lun.', 'Mar.', 'Mer.', 'Jeu.', 'Ven.', 'Sam.'],
                    dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],
                    weekHeader: 'Sem.',
                    dateFormat: 'dd-mm-yy',
                    onSelect: function(dateText, inst) {
                        date = dateText;
                    }

                });
                
                $.ajax({
                    type: "GET",
                    url: url1, //"http://localhost:8080/PrintMvnWeb/webresources/home/getOfList",
                    dataType: "json",
                    success: function (data) {
                        alert("Success!\n" + "data is:" + JSON.stringify(data));
                        $('#eventsTable').bootstrapTable({data: data});
                        $("#eventsTable tbody tr td input").each(function(i) {
                            $(this).attr('name', 'ofNum');
                        });
                    },
                    error: function (data) {
                        alert('Error: ' + data);
                    }
                });
                
                $('#eventsTable').on('check.bs.table', function (e, row) {
                    console.log([{ofNum: row.ofNum, reference: row.reference, sreference: row.sreference}]);
                    $('#ofNum').text(row.ofNum);
                    $('#ref').text(row.reference);
                    $('#sref').text(row.sreference);
                });
                
                $.ajax({
                    type: "GET",
                    url: url2, //"http://localhost:8080/PrintMvnWeb/webresources/home/getAllPrinter
                    dataType: "json",
                    success: function (data) {
                        alert("Success!\n" + "data is:" + JSON.stringify(data));
                        $('#printerTable').bootstrapTable({data: data});
                        $("#printerTable tbody tr td input").each(function(i) {
                            $(this).attr('name', 'NAME');
                        });
                    },
                    error: function (data) {
                        alert('Error: ' + data);
                    }
                });

                $('#printerTable tbody tr').each(function(){
                    $(this).attr('name','printer');
                });
               
                $('#printerTable').on('check.bs.table', function (e, row) {
                    console.log([{NAME: row.NAME}]);
                    $('#printer').text(row.NAME);
                });
            });

            $("#btn_print").click(function () {
                var postMessage;
                var ss = '';
                var result = null;
                var ofNum_val;
                var NAME_val;
                var num_val;
                var type_val;
                var express_val;
                var date_val;
                var bl_val;

                ofNum_val = $('#ofNum').text();
                NAME_val = $('#printer').text();
                num_val = $.trim($('#number').val());
                type_val = $.trim($('#type').val());
                express_val = $.trim($('#express').val());
                
                date_val  = $("#datepicker").datepicker( "getDate" );
                
                bl_val = $.trim($('#bl').val());

                postMessage = {ofNum: ofNum_val, NAME: NAME_val, num: num_val,
                    type: type_val,  date: date_val,express: express_val, bl: bl_val};

                if (ofNum_val === '')
                    ss = ss + "l'Of \n";
                if (NAME_val === '')
                    ss = ss + "l'imprimante \n";
                if (num_val === '')
                    ss = ss + "le nombre de Etiquettes \n";
                if (type_val === '')
                    ss = ss + "le type de Etiquettes \n";
                if (express_val === '')
                    ss = ss + "le numéro de Expédition \n";
                if (date_val === '')
                    ss = ss + "la data \n";
                if (bl_val === '')
                    ss = ss + "le numéro de BL \n"

                if (ss !== '') {
                    result = "Vous avez besoin de saisir/choisir ces valeurs dans les champs correspondants: \n" + ss;
                    alert(result);
                } else {
                    alert("Now launcing web service!");
                    alert(JSON.stringify(postMessage));
                    $.ajax({
                        url: "http://localhost:8080/PrintMvnWeb/webresources/home/postPrintMessage",
                        type: 'POST',
                        dataType: 'text',
                        data: JSON.stringify(postMessage),
                        headers: {
                            'Accept': 'text/plain',
                            'Content-Type': 'application/json'
                        },
                        success: function (result) {
                            alert("success post to web service! result is " + JSON.stringify(result));
                            window.location.href = "retour.html";
                        },
                        error: function (result) {
                            alert("wrong: " + JSON.stringify(result));
                        }
                    });
                }
            });





        </script>

    </body>
</html>